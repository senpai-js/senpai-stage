!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.senpaiStage={})}(this,function(t){var e=Math.PI,i=2*e;function n(t){return function(e){return 1-t(1-e)}}function r(t){var e=n(t);return function(i){return i<.5?.5*t(2*i):.5+.5*e(2*i-1)}}var s=function(t){return t},o=function(t){return Math.pow(t,2)},a=n(o),h=r(o),l=function(t){return Math.pow(t,3)},c=n(l),u=r(l),p=function(t){return Math.pow(t,4)},d=n(p),f=r(p),v=function(t){return Math.pow(t,5)},x=n(v),y=r(v),g=function(t){return Math.sin(t*e*.5)},m=n(g),w=r(m),S=function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*i/.3)+1},C=n(S),k=r(C),P={easeLinear:s,easeInQuad:o,easeOutQuad:a,easeInOutQuad:h,easeInCub:l,easeOutCub:c,easeInOutCub:u,easeInQuart:p,easeOutQuart:d,easeInOutQuart:f,easeInQuint:v,easeOutQuint:x,easeInOutQuint:y,easeOutSin:g,easeInSin:m,easeInOutSin:w,easeOutElastic:S,easeInElastic:C,easeInOutElastic:k},b=function(){function t(t){this.value=null,this.value=t}return t.prototype.translate=function(t,e){return this.value[4]+=this.value[0]*t+this.value[2]*e,this.value[5]+=this.value[1]*t+this.value[3]*e,this},t.prototype.scale=function(t,e){return this.value[0]*=t,this.value[1]*=t,this.value[2]*=e,this.value[3]*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.value[0],r=this.value[1],s=this.value[2],o=this.value[3];return this.value[0]=n*e+s*i,this.value[1]=r*e+o*i,this.value[2]=s*e-n*i,this.value[3]=o*e-r*i,this},t.prototype.skewX=function(t){var e=Math.tan(t);return this.value[2]+=this.value[0]*e,this.value[3]+=this.value[1]*e,this},t.prototype.skewY=function(t){var e=Math.tan(t);return this.value[0]+=this.value[2]*e,this.value[1]+=this.value[3]*e,this},t.prototype.inverse=function(){var t=this.value[0],e=this.value[1],i=this.value[2],n=this.value[3],r=this.value[4],s=this.value[5],o=1/(t*n-i*e);return this.value[0]=n*o,this.value[1]=-e*o,this.value[2]=-i*o,this.value[3]=t*o,this.value[4]=(i*s-r*n)*o,this.value[5]=(r*e-t*s)*o,this},t.prototype.transform=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=this.value[0],h=this.value[1],l=this.value[2],c=this.value[3],u=this.value[4],p=this.value[5];return this.value[0]=a*e+l*i,this.value[1]=h*e+c*i,this.value[2]=a*n+l*r,this.value[3]=h*n+c*r,this.value[4]=a*s+l*o+u,this.value[5]=h*s+c*o+p,this},t.prototype.reset=function(){return this.value[0]=1,this.value[1]=0,this.value[2]=0,this.value[3]=1,this.value[4]=0,this.value[5]=0,this},t.prototype.set=function(t){return this.value[0]=t[0],this.value[1]=t[1],this.value[2]=t[2],this.value[3]=t[3],this.value[4]=t[4],this.value[5]=t[5],this},t.prototype.setTo=function(t){return t[0]=this.value[0],t[1]=this.value[1],t[2]=this.value[2],t[3]=this.value[3],t[4]=this.value[4],t[5]=this.value[5],this},t.prototype.transformPoint=function(t){return _(t,this.value),this},t}(),T=[1,0,0,1,0,0];function I(t){return E([t[0],t[1],t[2],t[3],t[4],t[5]])}function E(t){return new b(t)}function _(t,e){t.tx=e[0]*t.x+e[2]*t.y+e[4],t.ty=e[1]*t.x+e[3]*t.y+e[5]}var R=Math.PI/180;var M,B=1/R,L=2*Math.PI;function z(t,e){return(t%e+e)%e}!function(t){t[t.BottomCenter=0]="BottomCenter",t[t.BottomCenterLeft=1]="BottomCenterLeft",t[t.BottomCenterRight=2]="BottomCenterRight",t[t.BottomLeft=3]="BottomLeft",t[t.BottomRight=4]="BottomRight",t[t.CenterLeft=5]="CenterLeft",t[t.Center=6]="Center",t[t.CenterRight=7]="CenterRight",t[t.Left=8]="Left",t[t.Right=9]="Right",t[t.TopCenter=10]="TopCenter",t[t.TopCenterLeft=11]="TopCenterLeft",t[t.TopCenterRight=12]="TopCenterRight",t[t.TopLeft=13]="TopLeft",t[t.TopRight=14]="TopRight"}(M||(M={}));var F,A={CanvasMatrix2DTransformAPI:b,Identity:T,copy:I,use:E,transformPoint:_,rads:function(t){return z(t,360)*R},degs:function(t){return z(t,L)*B},get StagePosition(){return M},align:function(t,e){if(!t.container)throw new Error("Sprite cannot be aligned because it was not added to a stage.");var i=t.container,n=0;switch(e){case M.BottomCenterLeft:case M.CenterLeft:case M.TopCenterLeft:n=.25;break;case M.BottomCenter:case M.Center:case M.TopCenter:n=.5;break;case M.BottomCenterRight:case M.CenterRight:case M.TopCenterRight:n=.75;break;case M.BottomRight:case M.Right:case M.TopRight:n=1}var r=0;switch(e){case M.Center:case M.CenterLeft:case M.CenterRight:case M.Left:case M.Right:r=.5;break;case M.BottomCenter:case M.BottomCenterLeft:case M.BottomCenterRight:case M.BottomLeft:case M.BottomRight:r=1}return I(T).translate(i.canvas.width*n,i.canvas.height*r).translate(-t.width*n,-t.height*r)}},D=function(t,e){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function K(t,e){function i(){this.constructor=t}D(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function H(t,e,i,n){return new(i||(i=Promise))(function(r,s){function o(t){try{h(n.next(t))}catch(t){s(t)}}function a(t){try{h(n.throw(t))}catch(t){s(t)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,a)}h((n=n.apply(t,e||[])).next())})}function U(t,e){var i,n,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function O(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}function X(t,e){return H(this,void 0,void 0,function(){return U(this,function(i){switch(i.label){case 0:return[4,fetch(t,e)];case 1:return[4,i.sent().json()];case 2:return[2,N(i.sent())]}})})}function N(e){var i;if(Array.isArray(e))return(i=e).kind=t.SpriteSheetKind.JSON,i;if(!e.frames)throw new Error("Invalid spritesheet format.");return i=Array.isArray(e.frames)?{frames:e.frames,kind:t.SpriteSheetKind.JSON_TP_Array,meta:e.meta}:{frames:e.frames,kind:t.SpriteSheetKind.JSON_TP_Hash,meta:e.meta}}function Y(e,i){return H(this,void 0,void 0,function(){var n,r,s,o,a,h,l,c,u,p,d,f,v,x,y,g,m,w,S,C,k,P,b,T,I,E,_,R,M,B,L;return U(this,function(z){switch(z.label){case 0:return l={},[4,e];case 1:return c=z.sent(),[4,i];case 2:return u=z.sent(),[4,N(c)];case 3:switch(p=z.sent(),p.kind){case t.SpriteSheetKind.JSON:return[3,4];case t.SpriteSheetKind.JSON_TP_Array:return[3,13];case t.SpriteSheetKind.JSON_TP_Hash:return[3,22]}return[3,31];case 4:d=c,z.label=5;case 5:z.trys.push([5,10,11,12]),f=O(d),v=f.next(),z.label=6;case 6:return v.done?[3,9]:(x=l,y=(_=v.value).name,[4,createImageBitmap(u,_.x,_.y,_.width,_.height)]);case 7:x[y]=z.sent(),z.label=8;case 8:return v=f.next(),[3,6];case 9:return[3,12];case 10:return g=z.sent(),n={error:g},[3,12];case 11:try{v&&!v.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}return[7];case 12:return[3,31];case 13:m=c,z.label=14;case 14:z.trys.push([14,19,20,21]),w=O(m.frames),S=w.next(),z.label=15;case 15:return S.done?[3,18]:(k=l,P=(C=S.value).filename,[4,createImageBitmap(u,C.frame.x,C.frame.y,C.frame.w,C.frame.h)]);case 16:k[P]=z.sent(),z.label=17;case 17:return S=w.next(),[3,15];case 18:return[3,21];case 19:return b=z.sent(),s={error:b},[3,21];case 20:try{S&&!S.done&&(o=w.return)&&o.call(w)}finally{if(s)throw s.error}return[7];case 21:return[3,31];case 22:T=c,z.label=23;case 23:z.trys.push([23,28,29,30]),I=O(Object.keys(T.frames)),E=I.next(),z.label=24;case 24:return E.done?[3,27]:(R=T.frames[_=E.value],M=l,B=_,[4,createImageBitmap(u,R.frame.x,R.frame.y,R.frame.w,R.frame.h)]);case 25:M[B]=z.sent(),z.label=26;case 26:return E=I.next(),[3,24];case 27:return[3,30];case 28:return L=z.sent(),a={error:L},[3,30];case 29:try{E&&!E.done&&(h=I.return)&&h.call(I)}finally{if(a)throw a.error}return[7];case 30:return[3,31];case 31:return[2,l]}})})}function j(t,e){return H(this,void 0,void 0,function(){var i;return U(this,function(n){switch(n.label){case 0:return[4,fetch(t,e)];case 1:return[4,n.sent().blob()];case 2:return i=n.sent(),[2,createImageBitmap(i)]}})})}(F=t.SpriteSheetKind||(t.SpriteSheetKind={}))[F.JSON=0]="JSON",F[F.JSON_TP_Hash=1]="JSON_TP_Hash",F[F.JSON_TP_Array=2]="JSON_TP_Array";var J,Q,V,W,G,Z,$={get SpriteSheetKind(){return t.SpriteSheetKind},loadSpriteSheet:X,createSpriteSheet:N,createTextureMap:Y,loadImage:j};function q(t,e){return t.z-e.z}!function(t){t.left="left",t.right="right",t.center="center",t.start="start",t.end="end"}(J||(J={})),function(t){t.top="top",t.hanging="hanging",t.middle="middle",t.alphabetic="alphabetic",t.ideographic="ideographic",t.bottom="bottom"}(Q||(Q={})),function(t){t[t.Playing=0]="Playing",t[t.Paused=1]="Paused",t[t.Stopped=2]="Stopped"}(V||(V={})),function(t){t.auto="auto",t.default="default",t.none="none",t["context-menu"]="context-menu",t.help="help",t.pointer="pointer",t.progress="progress",t.wait="wait",t.cell="cell",t.crosshair="crosshair",t.text="text",t["vertical-text"]="vertical-text",t.alias="alias",t.copy="copy",t.move="move",t["no-drop"]="no-drop",t["not-allowed"]="not-allowed",t["e-resize"]="e-resize",t["n-resize"]="n-resize",t["ne-resize"]="ne-resize",t["nw-resize"]="nw-resize",t["s-resize"]="s-resize",t["se-resize"]="se-resize",t["sw-resize"]="sw-resize",t["w-resize"]="w-resize",t["ew-resize"]="ew-resize",t["ns-resize"]="ns-resize",t["nesw-resize"]="nesw-resize",t["nwse-resize"]="nwse-resize",t["col-resize"]="col-resize",t["row-resize"]="row-resize",t["all-scroll"]="all-scroll",t["zoom-in"]="zoom-in",t["zoom-out"]="zoom-out",t.grab="grab",t.grabbing="grabbing"}(W||(W={})),function(t){t[t.Button=0]="Button",t[t.Character=1]="Character",t[t.Checkbox=2]="Checkbox",t[t.Close=3]="Close",t[t.Label=4]="Label",t[t.Panel=5]="Panel",t[t.Slider=6]="Slider",t[t.Textbox=7]="Textbox",t[t.TextInput=8]="TextInput",t[t.Sprite=9]="Sprite"}(G||(G={})),function(t){t[t.Wait=0]="Wait",t[t.Move=1]="Move",t[t.Repeat=2]="Repeat"}(Z||(Z={}));var tt,et={zSort:q,get TextAlign(){return J},get TextBaseline(){return Q},get PlayState(){return V},get Cursor(){return W},get SpriteType(){return G},get KeyFrameEntryType(){return Z}},it=function(){function t(){this.callbacks=[]}return t.prototype.clear=function(){this.callbacks=[]},t.prototype.listen=function(t){var e=this;return this.callbacks.push(t),{dispose:function(){e.callbacks.includes(t)&&e.callbacks.splice(e.callbacks.indexOf(t),1)}}},t.prototype.promise=function(){var t=this;return new Promise(function(e,i){var n=t.listen(function(t){n.dispose(),e(t)})})},t.prototype.once=function(t){var e=this.listen(function(i){t(i),e.dispose()});return e},t.prototype.emit=function(t){var e,i;try{for(var n=O(this.callbacks.slice()),r=n.next();!r.done;r=n.next()){(0,r.value)(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},t}(),nt=function(){function t(t){this.id="",this.type=G.Sprite,this.previousPosition=T.slice(),this.interpolatedPosition=T.slice(),this.inverse=T.slice(),this.interpolatedAlpha=1,this.previousAlpha=1,this.z=0,this.parent=null,this.container=null,this.lastInterpolated=0,this.cursor=W.auto,this.active=!1,this.hover=!1,this.down=!1,this.textures={},this.loaded=null,this.focused=!1,this.tabIndex=0,this.width=0,this.height=0,this.parentHoverCheck=!0,this.pointDownEvent=new it,this.pointUpEvent=new it,this.pointMoveEvent=new it,this.pointClickEvent=new it,this.keyDownEvent=new it,this.keyUpEvent=new it,this.keyPressEvent=new it,this.loadedEvent=new it,this.textureChangeEvent=new it,this.keyFrames=[],this.id=t.id;var e=t.position||T.slice();this.textures=t.textures?t.textures:this.textures,E(e).setTo(this.previousPosition).setTo(this.interpolatedPosition),t.hasOwnProperty("alpha")&&(this.previousAlpha=this.interpolatedAlpha=t.alpha),t.hasOwnProperty("z")&&(this.z=t.z),t.source&&t.definition&&this.loadTexture(t.definition,t.source)}return t.prototype.broadPhase=function(t){return t.tx>=0&&t.tx<=this.width&&t.ty>=0&&t.ty<=this.height},t.prototype.narrowPhase=function(t){return this},t.prototype.pointCollision=function(t){return!0},t.prototype.pointClick=function(t){},t.prototype.isHovering=function(t,e){if(this.interpolate(e),this.parentHoverCheck)for(var i=this.parent;i;){if(_(t,i.inverse),!i.broadPhase(t)||!i.narrowPhase(t))return null;i=i.parent}if(_(t,this.inverse),this.broadPhase(t))return this.narrowPhase(t)},t.prototype.isFocused=function(){return this.focused?this:null},t.prototype.wait=function(t){if(!Number.isFinite(t))throw new Error("Cannot create wait keyframe: wait time is not finite (received: "+t+")");if(t<0)throw new Error("Cannot create wait keyframe: wait time is not positive (received: "+t+")");var e=this.getLastKeyFrame();if(e&&e.type===Z.Repeat)throw new Error("Cannot move sprite after an animation repeats. (Did you call repeat before sprite.wait?)");var i=this.createKeyFrame();return i.type=Z.Wait,i.end=i.start+t,this.keyFrames.push(i),this},t.prototype.movePosition=function(t){var e=this.getLastKeyFrame();if(e&&e.type===Z.Repeat)throw new Error("Cannot move sprite after an animation repeats. (Did you call repeat before sprite.movePosition?)");var i=t.sx||0===t.sx?t.sx:t.s,n=t.sy||0===t.sy?t.sy:t.s,r=this.createKeyFrame(),s=I(T).translate(t.x||0,t.y||0).rotate(t.r||0).scale(0===i?0:i||1,0===n?0:n||1).translate(t.cx?-t.cx:0,t.cy?-t.cy:0).value;return r.to=s,this.keyFrames.push(r),this},t.prototype.move=function(t){for(var e=0;e<6;e++)if(!Number.isFinite(t[e]))throw new Error("Invalid Canvas Matrix for sprite "+this.id+", property "+e+" is not a finite value.");var i=this.getLastKeyFrame();if(i&&i.type===Z.Repeat)throw new Error("Cannot move sprite after an animation repeats. (Did you call repeat before sprite.move?)");var n=this.createKeyFrame();return n.to=I(t).value,this.keyFrames.push(n),this},t.prototype.visible=function(t){if(void 0===t&&(t=1),!Number.isFinite(t))throw new Error("Cannot set alpha value on sprite "+this.id+": "+t+" is not finite. This results in undefined behavior.");if(t<0||t>1)throw new Error("Cannot set alpha value on sprite "+this.id+": "+t+" is not within range [0, 1].");var e=this.getLastKeyFrame();if(e&&e.type===Z.Repeat)throw new Error("Cannot make sprite visible after an animation repeats. (Did you call repeat before sprite.visible?)");var i=e||this.createKeyFrame();return i.alpha=t,0===this.keyFrames.length&&this.keyFrames.push(i),this},t.prototype.setZ=function(t){if(!Number.isFinite(t))throw new Error("Cannot set Z value on sprite "+this.id+": "+t+" is not finite. This results in undefined behavior.");return this.z=t,this},t.prototype.over=function(t){if(!Number.isFinite(t))throw new Error("Cannot set timespan: Timespan is not finite (received value "+t+")");if(t<0)throw new Error("Cannot set timespan: Timespan is not positive (received value "+t+")");var e=this.getLastKeyFrame();if(!e)throw new Error("Cannot set timespan: no keyframe exists.");if(e&&e.type===Z.Repeat)throw new Error("Cannot change sprite animation length after an animation repeats. (Did you call repeat before sprite.over?)");return e.end=e.start+t,this},t.prototype.skipAnimation=function(t){var e=this.getLastKeyFrame();return!!e&&(e.type!==Z.Repeat&&(this.clearAnimation(t),e.end>t))},t.prototype.update=function(){},t.prototype.interpolate=function(t){var e,i;if(!(t<=this.lastInterpolated)){this.lastInterpolated=t;var n=this.keyFrames[0];t=Math.max(n?n.start:0,t);try{for(var r=O(this.keyFrames),s=r.next();!s.done;s=r.next()){var o=s.value;if(o.start<=t){var a=(t-o.start)/(o.end-o.start),h=o.ease(a);E(this.interpolatedPosition).set(a>1?o.to:[o.from[0]+h*(o.to[0]-o.from[0]),o.from[1]+h*(o.to[1]-o.from[1]),o.from[2]+h*(o.to[2]-o.from[2]),o.from[3]+h*(o.to[3]-o.from[3]),o.from[4]+h*(o.to[4]-o.from[4]),o.from[5]+h*(o.to[5]-o.from[5])]),this.interpolatedAlpha=o.previousAlpha+h*(o.alpha-o.previousAlpha)}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}if(I(this.interpolatedPosition).inverse().setTo(this.inverse),this.parent){this.parent.interpolate(t);var l=this.parent;I(l.inverse).translate(-l.padding.left,-l.padding.top).transform(this.inverse).setTo(this.inverse)}}},t.prototype.setTexture=function(t){var e=this.texture;return this.texture=t,this.width=this.textures[this.texture].width,this.height=this.textures[this.texture].height,e!==this.texture&&this.textureChangeEvent.emit({eventType:"ValueChange",previousValue:e,property:"texture",source:this,stage:this.container,value:this.texture}),this},t.prototype.render=function(t){t.drawImage(this.textures[this.texture],0,0)},t.prototype.keyDown=function(t){this.keyDownEvent.emit(t)},t.prototype.keyUp=function(t){this.keyUpEvent.emit(t)},t.prototype.keyPress=function(t){this.keyPressEvent.emit(t)},t.prototype.with=function(t){var e=this.getLastKeyFrame();if(!e)throw new Error("Cannot use provided ease because no keyFrames have been created.");if("function"!=typeof t)throw new Error("Cannot set ease: Ease is not a function. (Received: "+t+")");if(e.type===Z.Repeat)throw new Error("Cannot set ease function of KeyFrame type 'repeat.'");return e.ease=t,this},t.prototype.repeat=function(){var t=this.createKeyFrame();return t.type=Z.Repeat,this.keyFrames.push(t),this},t.prototype.clearAnimation=function(t){var e=this.getLastKeyFrame(),i=e?e.alpha:this.interpolatedAlpha;return this.interpolatedAlpha=i,this.previousAlpha=i,E(this.interpolatedPosition).set(e?e.to:this.interpolatedPosition),E(this.previousPosition).set(this.interpolatedPosition),this.lastInterpolated=t,this.keyFrames=[],this},t.prototype.getStage=function(){return this.container?this.container:this.parent?this.parent.getStage():null},t.prototype.loadTexture=function(t,e){return H(this,void 0,void 0,function(){var i,n,r,s;return U(this,function(o){switch(o.label){case 0:return i=this,[4,Y(t,e)];case 1:return i.textures=o.sent(),r=(n=this.loadedEvent).emit,s={},[4,t];case 2:return s.definition=o.sent(),s.eventType="SpriteLoaded",s.source=this,[4,e];case 3:return r.apply(n,[(s.spriteSource=o.sent(),s.stage=this.container,s)]),[2]}})})},t.prototype.createKeyFrame=function(){var t=this.getLastKeyFrame(),e=t?t.to:this.interpolatedPosition,i=t?t.alpha:this.interpolatedAlpha,n=t?t.end:Date.now();return{alpha:i,ease:t?t.ease:s,end:n,from:I(e).value,previousAlpha:i,start:n,to:I(e).value,type:Z.Move}},t.prototype.getLastKeyFrame=function(){return this.keyFrames.length>0?this.keyFrames[this.keyFrames.length-1]:null},t}(),rt=function(t){function e(e){var i=t.call(this,e)||this;return i.type=G.Button,i.selected=!1,i.font="monospace",i.fontColor="black",i.fontSize=12,i.text="",i.textAlign=J.center,i.textBaseline=Q.middle,i.cursor=W.pointer,i.selected=e.selected||!1,i.font=e.font||i.font,i.fontColor=e.fontColor||i.fontColor,i.fontSize=e.fontSize||i.fontSize,i.text=e.text||i.text,i.textAlign=e.textAlign,i.textBaseline=e.textBaseline,i}return K(e,t),e.prototype.update=function(){this.setTexture((this.active?"Active":"Inactive")+"_"+(this.hover?"Hover":"NoHover")+"_"+(this.selected?"Selected":"Unselected")),t.prototype.update.call(this)},e.prototype.render=function(e){t.prototype.render.call(this,e),e.translate(.5*this.textures[this.texture].width,.5*this.textures[this.texture].height),e.textBaseline=Q.middle,e.textAlign=J.center,e.font=this.fontSize+"px "+this.font,e.fillStyle=this.fontColor,e.fillText(this.text,0,0)},e.prototype.setText=function(t){return this.text=t,this},e}(nt),st=function(t){function e(e){var i=t.call(this,e)||this;return i.type=G.Character,i.name="",i.displayName="",i.color="",i.displayName=e.displayName,i.color=e.color,i}return K(e,t),e}(nt),ot=function(t){function e(e){var i=t.call(this,e)||this;return i.type=G.Checkbox,i.checked=!1,i.text="",i.font="monospace",i.fontColor="black",i.fontSize=12,i.textAlign=J.left,i.textBaseline=Q.middle,i.checkedChangeEvent=new it,i.cursor=W.pointer,i.checked=Boolean(e.checked)||!1,i.text=e.text||i.text,i.font=e.font||i.font,i.fontColor=e.fontColor||i.fontColor,i.textAlign=e.textAlign||i.textAlign,i.textBaseline=e.textBaseline||i.textBaseline,i}return K(e,t),e.prototype.toggle=function(){var t=this.checked;return this.checked=!this.checked,this.checkedChangeEvent.emit({eventType:"ValueChange",previousValue:t,property:"checked",source:this,stage:this.container,value:this.checked}),this},e.prototype.pointClick=function(e){return this.toggle(),t.prototype.pointClick.call(this,e)},e.prototype.render=function(e){t.prototype.render.call(this,e),e.translate(1.1*this.width,this.height/2),e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.fillStyle=this.fontColor,e.font=this.fontSize+"px "+this.font,e.fillText(this.text,0,0)},e.prototype.update=function(){this.setTexture((this.active?"Active":"Inactive")+"_"+(this.hover?"Hover":"NoHover")+"_"+(this.checked?"Checked":"Unchecked")),t.prototype.update.call(this)},e.prototype.setText=function(t){return this.text=t,this},e}(nt),at=function(t){function e(e){var i=t.call(this,e)||this;return i.type=G.Close,i}return K(e,t),e.prototype.update=function(){this.setTexture((this.active?"Active":"Inactive")+"_"+(this.hover?"Hover":"NoHover")),this.cursor=this.hover?W.pointer:W.auto,t.prototype.update.call(this)},e}(nt),ht=function(){function t(t){this.sprites=[],this.playables=[],this.points=[],this.audioContext=null,this.audioContext=t.audioContext}return t.prototype.addSprite=function(t){return this.sprites.includes(t)||(this.sprites.push(t),t.container=this),this},t.prototype.removeSprite=function(t){return this.sprites.includes(t)&&(this.sprites.splice(this.sprites.indexOf(t),1),t.container=null),this},t.prototype.addPlayable=function(t){return this.playables.includes(t)||this.playables.push(t),this},t.prototype.removePlayable=function(t){return this.playables.includes(t)&&this.playables.splice(this.playables.indexOf(t),1),this},t.prototype.addPoint=function(t){return this.points.includes(t)||this.points.push(t),this},t.prototype.removePoint=function(t){return this.points.includes(t)&&this.points.splice(this.points.indexOf(t),1),this},t.prototype.getSpriteByID=function(t){var e,i;try{for(var n=O(this.sprites),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.id===t)return s}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return null},t.prototype.getPointByID=function(t){var e,i;try{for(var n=O(this.points),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.id===t)return s}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return null},t.prototype.getPlayableByID=function(t){var e,i;try{for(var n=O(this.playables),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.id===t)return s}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return null},t}(),lt=function(t){function e(e){var i=t.call(this,e)||this;return i.canvas=null,i.ctx=null,i.touchPointIndex={},i.keyIndex={},i.mousePoint={active:null,captured:!1,clicked:!1,down:!1,firstDown:!1,hover:null,id:"mouse",tx:0,ty:0,type:"Mouse",x:0,y:0},i.insertMode=!1,i.pointDownEvent=new it,i.pointUpEvent=new it,i.pointMoveEvent=new it,i.mouseDownEvent=new it,i.mouseUpEvent=new it,i.mouseMoveEvent=new it,i.touchCancelEvent=new it,i.touchEndEvent=new it,i.touchMoveEvent=new it,i.touchStartEvent=new it,i.keyDownEvent=new it,i.keyUpEvent=new it,i.keyPressEvent=new it,i.events=[{target:null,event:"mousedown",listener:function(t){return i.mouseDown(t)}},{target:window,event:"mouseup",listener:function(t){return i.mouseUp(t)}},{target:null,event:"mousemove",listener:function(t){return i.mouseMove(t)}},{target:null,event:"touchstart",listener:function(t){return i.touchStart(t)}},{target:window,event:"touchend",listener:function(t){return i.touchEnd(t)}},{target:null,event:"touchmove",listener:function(t){return i.touchMove(t)}},{target:window,event:"touchcancel",listener:function(t){return i.touchCancel(t)}}],i.keyboardEvents=[{target:window,event:"keydown",listener:function(t){return i.keyDown(t)}},{target:window,event:"keypress",listener:function(t){return i.keyPress(t)}},{target:window,event:"keyup",listener:function(t){return i.keyUp(t)}}],i.canvas=e.canvas,i.canvas||(i.canvas=document.createElement("canvas"),document.body.appendChild(i.canvas)),i.canvas.width=e.width,i.canvas.height=e.height,i.ctx=i.canvas.getContext("2d"),i.hookEvents(),i.addPoint(i.mousePoint),i}return K(e,t),e.prototype.hookEvents=function(){var t=this;this.events.forEach(function(e){return(e.target||t.canvas).addEventListener(e.event,e.listener)}),this.keyboardEvents.forEach(function(e){return(e.target||t.canvas).addEventListener(e.event,e.listener)})},e.prototype.dispose=function(){var t=this;this.events.forEach(function(e){return(e.target||t.canvas).removeEventListener(e.event,e.listener)})},e.prototype.mouseDown=function(t){return this.mouseDownEvent.emit({down:!0,eventType:"MouseDown",rawEvent:t,source:this,stage:this,x:t.clientX,y:t.clientY}),this.pointDown(this.mousePoint,t)},e.prototype.mouseUp=function(t){return this.mouseUpEvent.emit({down:!1,eventType:"MouseUp",rawEvent:t,source:this,stage:this,x:t.clientX,y:t.clientY}),this.pointUp(this.mousePoint,t)},e.prototype.mouseMove=function(t){return this.mouseMoveEvent.emit({down:this.mousePoint.down,eventType:"MouseMove",rawEvent:t,source:this,stage:this,x:t.clientX,y:t.clientY}),this.pointMove(this.mousePoint,t)},e.prototype.touchStart=function(t){for(var e,i,n=0;n<t.changedTouches.length;n++)this.touchStartEvent.emit({down:!0,eventType:"TouchStart",rawEvent:t,source:this,stage:this,touch:e=t.changedTouches[n],x:e.clientX,y:e.clientY}),i=this.addTouchPoint(e),this.pointDown(i,e)},e.prototype.touchEnd=function(t){for(var e,i=null,n=0;n<t.changedTouches.length;n++)this.touchEndEvent.emit({down:!1,eventType:"TouchEnd",rawEvent:t,source:this,stage:this,touch:i=t.changedTouches[n],x:i.clientX,y:i.clientY}),this.touchPointIndex[i.identifier]?(this.pointUp(e=this.touchPointIndex[i.identifier],i),this.removeTouchPoint(i)):(e=this.createInteractionPoint(i.identifier.toString(),"Touch"),this.pointMove(e,i))},e.prototype.touchCancel=function(t){for(var e=null,i=0;i<t.changedTouches.length;i++)this.touchCancelEvent.emit({down:!1,eventType:"TouchCancel",rawEvent:t,source:this,stage:this,touch:e=t.changedTouches[i],x:null,y:null}),this.touchPointIndex[e.identifier]&&(this.pointCancel(this.touchPointIndex[e.identifier],e),this.removeTouchPoint(e))},e.prototype.touchMove=function(t){for(var e,i=null,n=0;n<t.changedTouches.length;n++)this.touchMoveEvent.emit({down:!0,eventType:"TouchMove",rawEvent:t,source:this,stage:this,touch:i=t.changedTouches[n],x:i.clientX,y:i.clientY}),this.touchPointIndex[i.identifier]?e=this.touchPointIndex[i.identifier]:(e=this.addTouchPoint(i)).down=!0,this.pointMove(e,i)},e.prototype.pointDown=function(t,e){var i=t.down;i||(t.down=!0,t.firstDown=!0);var n=t.x,r=t.y;this.pointMove(t,e),i||(t.hover?(t.active=t.hover,t.active.down=!0,t.active.active=!0,this.setFocus(t.hover),t.active.pointDownEvent.emit({down:!0,eventType:"PointDown",point:t,previousX:n,previousY:r,source:t.active,stage:this,x:t.x,y:t.y})):this.setFocus(null),this.pointDownEvent.emit({down:!0,eventType:"PointDown",point:t,previousX:n,previousY:r,source:t.active,stage:this,x:t.x,y:t.y}),t.firstDown=!1)},e.prototype.pointUp=function(t,e){var i=t.x,n=t.y,r=null;this.pointMove(t,e),t.down&&(t.down=!1,t.active&&(t.active.down=!1,t.active.active=!1,t.active.pointUpEvent.emit({down:!1,eventType:"PointUp",point:t,previousX:i,previousY:n,source:t.active,stage:this,x:t.x,y:t.x}),t.hover===t.active&&(t.active.pointClick(t),t.active.pointClickEvent.emit({down:!1,eventType:"PointClick",point:t,previousX:i,previousY:n,source:t.active,stage:this,x:t.x,y:t.x})),r=t.active,t.active=null),this.pointUpEvent.emit({down:!1,eventType:"PointUp",point:t,previousX:i,previousY:n,source:r||this,stage:this,x:t.x,y:t.x}))},e.prototype.pointMove=function(t,e){var i,n,r=Date.now(),s=this.canvas.getBoundingClientRect(),o=t.x,a=t.y;t.x=e.clientX-s.left,t.y=e.clientY-s.top,t.hover&&(t.hover.hover=!1,t.hover=null),this.sprites.sort(q);for(var h=this.sprites.length-1;h>=0;h--)if(n=(i=this.sprites[h]).isHovering(t,r)){n.hover=!0,t.hover=n,n.pointCollision(t),n.pointMoveEvent.emit({down:t.down,eventType:"PointMove",point:t,previousX:o,previousY:a,source:i,stage:this,x:t.x,y:t.y});break}this.pointMoveEvent.emit({down:t.down,eventType:"PointMove",point:t,previousX:o,previousY:a,source:i,stage:this,x:t.x,y:t.y})},e.prototype.pointCancel=function(t,e){t.active&&(t.active.active=!1,t.active=null),t.hover&&(t.hover.hover=!1,t.hover=null)},e.prototype.createInteractionPoint=function(t,e){return{active:null,captured:!1,clicked:!1,down:!1,firstDown:!1,hover:null,id:t,tx:0,ty:0,type:e,x:0,y:0}},e.prototype.addTouchPoint=function(t){var e=this.createInteractionPoint(t.identifier.toString(),"Touch");return this.addPoint(e),this.touchPointIndex[t.identifier]=e,e},e.prototype.removeTouchPoint=function(t){var e=this.touchPointIndex[t.identifier];delete this.touchPointIndex[t.identifier],this.removePoint(e)},e.prototype.hoverCheck=function(t){var e,i,n;this.sprites.sort(q);try{for(var r=O(this.points),s=r.next();!s.done;s=r.next()){(n=s.value).hover&&(n.hover.hover=!1,n.hover=null);var o=void 0;if(n.active&&(o=n.active.isHovering(n,t)))o.pointCollision(n),n.hover=o,o.hover=!0;else for(var a=this.sprites.length-1;a>=0;a--)if(o=this.sprites[a].isHovering(n,t)){o.pointCollision(n),n.hover=o,o.hover=!0;break}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},e.prototype.keyUp=function(t){this.keyIndex[t.key]=!1;var e=this.getFocusedSprite();e&&e.keyUp({alt:t.altKey,ctrl:t.ctrlKey,down:!1,eventType:"KeyUp",key:t.key,shift:t.shiftKey,source:e,stage:this}),this.keyUpEvent.emit({alt:t.altKey,ctrl:t.ctrlKey,down:!1,eventType:"KeyUp",key:t.key,shift:t.shiftKey,source:e||this,stage:this})},e.prototype.keyDown=function(t){this.keyIndex[t.key]=!1,"Insert"===t.key&&(this.insertMode=!this.insertMode);var e=this.getFocusedSprite();e&&e.keyDown({alt:t.altKey,ctrl:t.ctrlKey,down:!0,eventType:"KeyDown",key:t.key,shift:t.shiftKey,source:e,stage:this}),this.keyDownEvent.emit({alt:t.altKey,ctrl:t.ctrlKey,down:!0,eventType:"KeyDown",key:t.key,shift:t.shiftKey,source:e||this,stage:this})},e.prototype.keyPress=function(t){var e=this.getFocusedSprite();e&&e.keyPress({alt:t.altKey,ctrl:t.ctrlKey,down:!0,eventType:"KeyPress",key:t.key,shift:t.shiftKey,source:e,stage:this}),this.keyPressEvent.emit({alt:t.altKey,ctrl:t.ctrlKey,down:!0,eventType:"KeyPress",key:t.key,shift:t.shiftKey,source:e||this,stage:this})},e.prototype.setFocus=function(t){var e,i;try{for(var n=O(this.sprites),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.focused=s===t,s.type===G.Panel)s.focus(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},e.prototype.getFocusedSprite=function(){var t,e;try{for(var i=O(this.sprites),n=i.next();!n.done;n=i.next()){var r=n.value.isFocused();if(r)return r}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e}(ht),ct=document.createElement("canvas").getContext("2d"),ut=function(t){function e(e){var i=t.call(this,e)||this;return i.type=G.Label,i.text="",i.font="monospace",i.fontSize=12,i.fontColor="black",i.textAlign=J.start,i.textBaseline=Q.hanging,i.text=e.text||i.text,i.font=e.font||i.font,i.fontSize=e.fontSize||i.fontSize,i.fontColor=e.fontColor||i.fontColor,i.textBaseline=e.textBaseline||i.textBaseline,i.textAlign=e.textAlign||i.textAlign,i}return K(e,t),e.prototype.update=function(){this.height=this.fontSize,ct.font=this.fontSize+"px "+this.font,this.width=ct.measureText(this.text).width},e.prototype.render=function(t){t.textBaseline=this.textBaseline,t.textAlign=this.textAlign,t.font=this.fontSize+"px "+this.font,t.fillStyle=this.fontColor,t.fillText(this.text,0,0)},e.prototype.setText=function(t){return this.text=t,this},e}(nt),pt=function(t,e){return t.z-e.z},dt=document.createElement("canvas").getContext("2d"),ft=function(t){function e(e){var i=t.call(this,e)||this;return i.type=G.Panel,i.padding={bottom:4,left:4,right:4,top:4},i.sprites=[],i.bottomCenterPattern=null,i.topCenterPattern=null,i.middleLeftPattern=null,i.middleRightPattern=null,i.middleCenterPattern=null,i.width=e.width,i.height=e.height,i.padding=e.padding||i.padding,i}return K(e,t),e.prototype.addSprite=function(t){return t.parent=this,this.sprites.push(t),this},e.prototype.interpolate=function(e){var i,n;if(!(e<=this.lastInterpolated)){t.prototype.interpolate.call(this,e);try{for(var r=O(this.sprites),s=r.next();!s.done;s=r.next()){s.value.interpolate(e)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}}},e.prototype.isHovering=function(e,i){var n,r,s,o=t.prototype.isHovering.call(this,e,i);if(!o)return null;this.sprites.sort(pt);try{for(var a=O(this.sprites),h=a.next();!h.done;h=a.next()){var l=h.value;l.down=!1,l.hover=!1}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}for(var c=this.sprites.length-1;c>=0;c--)if(s=this.sprites[c].isHovering(e,i))return s;return o},e.prototype.narrowPhase=function(t){if(t.tx>=this.padding.left&&t.tx<=this.width-this.padding.right&&t.ty>=this.padding.top&&t.ty<=this.height-this.padding.bottom)return this},e.prototype.removeSprite=function(t){return this.sprites.includes(t)&&(this.sprites.splice(this.sprites.indexOf(t),1),t.parent=null),this},e.prototype.update=function(){var t,e;this.hover=!1,!this.bottomCenterPattern&&this.textures.Bottom_Center&&(this.bottomCenterPattern=dt.createPattern(this.textures.Bottom_Center,"repeat-x")),!this.topCenterPattern&&this.textures.Top_Center&&(this.topCenterPattern=dt.createPattern(this.textures.Top_Center,"repeat-x")),!this.middleLeftPattern&&this.textures.Middle_Left&&(this.middleLeftPattern=dt.createPattern(this.textures.Middle_Left,"repeat-y")),!this.middleRightPattern&&this.textures.Middle_Right&&(this.middleRightPattern=dt.createPattern(this.textures.Middle_Right,"repeat-y")),!this.middleCenterPattern&&this.textures.Middle_Center&&(this.middleCenterPattern=dt.createPattern(this.textures.Middle_Center,"repeat")),this.textures.Top_Left&&this.textures.Top_Right&&this.textures.Bottom_Left&&this.textures.Bottom_Right&&(this.width=Math.max(this.width,this.textures.Bottom_Left.width+this.textures.Bottom_Right.width,this.textures.Top_Left.width+this.textures.Top_Right.width),this.height=Math.max(this.height,this.textures.Bottom_Left.width+this.textures.Top_Left.width,this.textures.Bottom_Right.width+this.textures.Top_Right.width));try{for(var i=O(this.sprites),n=i.next();!n.done;n=i.next()){n.value.update()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e.prototype.render=function(t){var e,i;if(this.textures.Top_Left&&t.drawImage(this.textures.Top_Left,0,0),this.textures.Top_Right&&t.drawImage(this.textures.Top_Right,this.width-this.textures.Top_Right.width,0),this.textures.Bottom_Left&&t.drawImage(this.textures.Bottom_Left,0,this.height-this.textures.Bottom_Left.width),this.textures.Bottom_Right&&t.drawImage(this.textures.Bottom_Right,this.width-this.textures.Bottom_Right.width,this.height-this.textures.Bottom_Right.height),this.topCenterPattern&&(t.beginPath(),t.fillStyle=this.topCenterPattern,t.fillRect(this.textures.Top_Left.width,0,this.width-this.textures.Top_Left.width-this.textures.Top_Right.width,this.textures.Top_Center.height)),this.bottomCenterPattern){var n=this.height-this.textures.Bottom_Center.height;t.beginPath(),t.fillStyle=this.bottomCenterPattern,t.translate(0,n),t.fillRect(this.textures.Bottom_Left.width,0,this.width-this.textures.Bottom_Left.width-this.textures.Bottom_Right.width,this.textures.Bottom_Center.height),t.translate(0,-n)}if(this.middleLeftPattern&&(t.beginPath(),t.fillStyle=this.middleLeftPattern,t.fillRect(0,this.textures.Top_Left.height,this.textures.Middle_Left.width,this.height-this.textures.Top_Left.height-this.textures.Bottom_Left.height)),this.middleRightPattern){var r=this.width-this.textures.Top_Right.width;t.beginPath(),t.fillStyle=this.middleRightPattern,t.translate(r,0),t.fillRect(0,this.textures.Top_Right.height,this.textures.Middle_Right.width,this.height-this.textures.Top_Right.height-this.textures.Bottom_Right.height),t.translate(-r,0)}this.middleCenterPattern&&(t.beginPath(),t.fillStyle=this.middleCenterPattern,t.fillRect(this.textures.Top_Left.width,this.textures.Top_Right.height,this.width-this.textures.Bottom_Right.width-this.textures.Bottom_Left.width,this.height-this.textures.Top_Right.height-this.textures.Bottom_Right.height)),t.beginPath(),t.rect(this.padding.left,this.padding.top,this.width-this.padding.left-this.padding.right,this.height-this.padding.top-this.padding.bottom),t.clip(),t.translate(this.padding.left,this.padding.top);try{for(var s=O(this.sprites),o=s.next();!o.done;o=s.next()){var a=o.value;t.save(),t.transform(a.interpolatedPosition[0],a.interpolatedPosition[1],a.interpolatedPosition[2],a.interpolatedPosition[3],a.interpolatedPosition[4],a.interpolatedPosition[5]),t.globalAlpha*=a.interpolatedAlpha,a.render(t),t.restore()}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}},e.prototype.focus=function(t){var e,i;try{for(var n=O(this.sprites),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.focused=s===t,s.type===G.Panel)s.focus(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},e.prototype.isFocused=function(){var e,i;try{for(var n=O(this.sprites),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.isFocused())return s}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return t.prototype.isFocused.call(this)},e.prototype.skipAnimation=function(e){var i,n,r=t.prototype.skipAnimation.call(this,e);try{for(var s=O(this.sprites),o=s.next();!o.done;o=s.next()){r=o.value.skipAnimation(e)||r}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return r},e}(nt),vt=function(){function t(t){this.id="",this.started=0,this.length=0,this.start=0,this.end=0,this.loop=!1,this.state=V.Stopped,this.id=t.id,this.context=t.context,this.definition=t.definition,this.start=this.definition.spritemap[t.texture].start,this.end=this.definition.spritemap[t.texture].end,this.length=this.end-this.start,this.gain=t.context.createGain(),this.loaded=this.createSource(t.source,t.context),this.destination=t.context.destination}return t.prototype.play=function(){var t=this;return this.loaded.then(function(e){return t.createPlayInstance()}),this},t.prototype.stop=function(){return this},t.prototype.pause=function(){return this},t.prototype.setVolume=function(t){if(t<0||t>1)throw new Error("setVolume() accepts a number between 0 and 1; got "+t+".");return this.gain.gain.value=t,this},t.prototype.createSource=function(t,e){return H(this,void 0,void 0,function(){var i,n;return U(this,function(r){switch(r.label){case 0:return[4,t];case 1:return[4,r.sent().arrayBuffer()];case 2:return i=r.sent(),n=this,[4,e.decodeAudioData(i)];case 3:return n.source=r.sent(),[2]}})})},t.prototype.createPlayInstance=function(){var t=this.context.createBufferSource();t.buffer=this.source,t.loop=this.loop,t.connect(this.gain),t.start(0,this.start,this.length);var e=this.gain;t.addEventListener("ended",function i(n){t.disconnect(e),t.removeEventListener("ended",i)})},t}(),xt=document.createElement("canvas").getContext("2d"),yt=function(t){function e(e){var i=t.call(this,e)||this;return i.type=G.Slider,i.value=0,i.max=1,i.min=0,i.width=100,i.height=0,i.parentHoverCheck=!1,i.valueChangeEvent=new it,i.cursor=W.pointer,i.sliderPattern=null,i.pillTexture=null,i.width=e.width,i.max=e.max||i.max,i.min=e.min||i.min,i.value=e.value||i.value,i}return K(e,t),e.prototype.broadPhase=function(e){return!!this.active||t.prototype.broadPhase.call(this,e)},e.prototype.narrowPhase=function(t){return this.active||t.firstDown?this:this.pointInPill(t)?this:void 0},e.prototype.pointInPill=function(t){var e=(this.width-this.textures.Pill_Hover.width)*((this.value-this.min)/(this.max-this.min));return t.ty<=this.textures.Pill_Hover.height&&t.ty>=0&&t.tx>=e&&t.tx<=e+this.textures.Pill_Hover.width},e.prototype.pointCollision=function(e){if(t.prototype.pointCollision.call(this,e),this.active&&e.active===this){var i=this.value,n=this.width-this.textures.Pill_Hover.width,r=Math.max(0,Math.min(e.tx-.5*this.textures.Pill_Hover.width,n));this.value=this.min+(this.max-this.min)*r/n,this.value!==i&&this.valueChangeEvent.emit({eventType:"ValueChange",previousValue:i,property:"value",source:this,stage:this.container,value:this.value})}return!0},e.prototype.update=function(){this.textures.Pill_Hover&&(this.height=this.textures.Pill_Hover.height),!this.sliderPattern&&this.textures.Line&&(this.sliderPattern=xt.createPattern(this.textures.Line,"repeat-x")),this.pillTexture=this.active?this.textures.Pill_Active:this.hover?this.textures.Pill_Hover:this.textures.Pill},e.prototype.render=function(t){t.drawImage(this.textures.Line_Cap_Left,0,0),t.drawImage(this.textures.Line_Cap_Right,this.width-this.textures.Line_Cap_Right.width,0),t.fillStyle=this.sliderPattern,t.fillRect(this.textures.Line_Cap_Left.width,0,this.width-this.textures.Line_Cap_Left.width-this.textures.Line_Cap_Right.width,this.textures.Line.height),t.drawImage(this.pillTexture,(this.width-this.textures.Pill_Hover.width)*((this.value-this.min)/(this.max-this.min)),0)},e}(nt),gt=function(t){function e(e){var i=t.call(this,e)||this;return i.postInterpolateEvent=new it,i.preInterpolateEvent=new it,i.preHoverCheckEvent=new it,i.postHoverCheckEvent=new it,i.preUpdateEvent=new it,i.postUpdateEvent=new it,i.preRenderEvent=new it,i.postRenderEvent=new it,i}return K(e,t),e.prototype.update=function(){var t,e,i,n,r=Date.now();this.preInterpolateEvent.emit({eventType:"PreInterpolate",source:this,stage:this});try{for(var s=O(this.sprites),o=s.next();!o.done;o=s.next())o.value.interpolate(r)}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}this.postInterpolateEvent.emit({eventType:"PostInterpolate",source:this,stage:this}),this.preHoverCheckEvent.emit({eventType:"PreHoverCheck",source:this,stage:this}),this.hoverCheck(r),this.postHoverCheckEvent.emit({eventType:"PostHoverCheck",source:this,stage:this}),this.preUpdateEvent.emit({eventType:"PreUpdate",source:this,stage:this});try{for(var a=O(this.sprites),h=a.next();!h.done;h=a.next())h.value.update()}catch(t){i={error:t}}finally{try{h&&!h.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return this.postUpdateEvent.emit({eventType:"PostUpdate",source:this,stage:this}),this},e.prototype.render=function(){var t,e,i,n,r;this.preRenderEvent.emit({eventType:"PreRender",source:this,stage:this});var s=this.ctx;s.clearRect(0,0,this.canvas.width,this.canvas.height);try{for(var o=O(this.sprites),a=o.next();!a.done;a=o.next())r=a.value,s.save(),s.setTransform(r.interpolatedPosition[0],r.interpolatedPosition[1],r.interpolatedPosition[2],r.interpolatedPosition[3],r.interpolatedPosition[4],r.interpolatedPosition[5]),s.globalAlpha=r.interpolatedAlpha,r.render(s),s.restore()}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}this.canvas.style.cursor=W.auto;try{for(var h=O(this.points),l=h.next();!l.done;l=h.next()){var c=l.value;c.hover&&(this.canvas.style.cursor=c.hover.cursor)}}catch(t){i={error:t}}finally{try{l&&!l.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}return this.postRenderEvent.emit({eventType:"PostRender",source:this,stage:this}),this},e.prototype.skipAnimations=function(){var t,e,i=Date.now(),n=!1;try{for(var r=O(this.sprites),s=r.next();!s.done;s=r.next()){s.value.skipAnimation(i)&&(n=!0)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},e}(lt),mt=document.createElement("canvas").getContext("2d"),wt=function(t){function e(e){var i=t.call(this,e)||this;return i.type=G.Textbox,i.text="",i.textSpeed=1,i.textIndex=0,i.padding={bottom:5,left:5,right:5,top:5},i.fontSize=12,i.font="monospace",i.fontColor="black",i.lineHeight=16,i.textAlign=J.left,i.textBaseline=Q.hanging,i.interpolatedText=[""],i.text=e.text||i.text,i.textSpeed=e.textSpeed||i.textSpeed,e.hasOwnProperty("textIndex")&&(i.textIndex=e.textIndex),i.padding=e.padding||i.padding,i.fontSize=e.fontSize||i.fontSize,i.font=e.font||i.font,i.fontColor=e.fontColor||i.fontColor,i.lineHeight=e.lineHeight||i.lineHeight,i.setTexture("Texture"),i}return K(e,t),e.prototype.update=function(){var t,i,n=this.textures[this.texture].width-this.padding.left-this.padding.right;this.textIndex=Math.min(this.text.length,this.textIndex+this.textSpeed);var r=this.text.match(e.regex);this.interpolatedText=[""];var s=(this.textures[this.texture].height-this.padding.top-this.padding.bottom)/this.lineHeight,o="",a=0,h=this.textIndex;mt.font=this.fontSize+"px "+this.font;try{for(var l=O(r),c=l.next();!c.done;c=l.next()){var u=c.value;if("\n"!==u&&"\r\n"!==u&&"\r"!==u){if(o=this.interpolatedText[a],0===h)break;if(a+1>s)break;if(mt.measureText(o+=u).width>n&&(a=this.interpolatedText.push("")-1),this.interpolatedText[a]+=u,(h-=u.length)<0){this.interpolatedText[a]=this.interpolatedText[a].slice(0,h);break}}else this.interpolatedText.push(""),h-=u.length,a+=1}}catch(e){t={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(t)throw t.error}}},e.prototype.render=function(e){var i,n;t.prototype.render.call(this,e);var r=this.textures[this.texture].height-this.padding.top,s=this.padding.top;e.font=this.fontSize+"px "+this.font,e.fillStyle=this.fontColor,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.beginPath(),e.rect(this.padding.left,this.padding.bottom,this.width-this.padding.right,this.height-this.padding.top),e.clip();try{for(var o=O(this.interpolatedText),a=o.next();!a.done;a=o.next()){if(s+this.fontSize>r)break;e.fillText(a.value,this.padding.left,s),s+=this.lineHeight}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},e.prototype.setText=function(t){return t.startsWith(this.text)?(this.text=t,this):(this.text=t,this.interpolatedText=[""],this.textIndex=0,this)},e.prototype.appendText=function(t){return this.text+=t,this},e.prototype.skipAnimation=function(e){var i=t.prototype.skipAnimation.call(this,e)&&this.textIndex<this.text.length;return this.textIndex=this.text.length,i},e.regex=/\r\n|\r|\n|[^\t ]*[\t ]?/g,e}(nt),St=/^.$/u;(tt=t.SelectionState||(t.SelectionState={}))[tt.Selection=0]="Selection",tt[tt.Caret=1]="Caret";var Ct=document.createElement("canvas").getContext("2d"),kt=function(e){function i(i){var n=e.call(this,i)||this;return n.type=G.TextInput,n.text=[],n.font="monospace",n.fontSize=12,n.fontColor="black",n.selectedFontColor="white",n.selectedFontBackgroundColor="blue",n.caretIndex=0,n.caretX=0,n.textScroll=0,n.selectionState=t.SelectionState.Caret,n.padding={bottom:6,left:6,right:6,top:6},n.selectionEnd=-1,n.selectionStart=-1,n.frameCount=0,n.cursor=W.text,n.parentHoverCheck=!1,n.showCaret=!0,n.focusedMidPattern=null,n.unfocusedMidPattern=null,n.text=i.text?i.text.split(""):n.text,n.font=i.font||n.font,n.fontSize=i.fontSize||n.fontSize,n.fontColor=i.fontColor||n.fontColor,n.selectedFontBackgroundColor=i.selectedFontBackgroundColor||n.selectedFontBackgroundColor,n.selectedFontColor=i.selectedFontColor||n.selectedFontColor,n.width=i.width||n.width,n}return K(i,e),i.prototype.broadPhase=function(t){return!!this.active||e.prototype.broadPhase.call(this,t)},i.prototype.narrowPhase=function(t){return this.active?this:t.tx>this.padding.left&&t.ty>this.padding.top&&t.tx<this.width-this.padding.right&&t.ty<this.height-this.padding.bottom?this:null},i.prototype.update=function(){(this.focused||(this.selectionState=t.SelectionState.Caret),!this.focusedMidPattern&&this.textures.Focused_Mid&&(this.focusedMidPattern=Ct.createPattern(this.textures.Focused_Mid,"repeat-x")),!this.unfocusedMidPattern&&this.textures.Unfocused_Mid&&(this.unfocusedMidPattern=Ct.createPattern(this.textures.Unfocused_Mid,"repeat-x")),this.height=this.textures.Focused_Left.height,this.frameCount+=1,this.frameCount>=30&&(this.showCaret=!this.showCaret,this.frameCount-=30),Ct.font=this.fontSize+"px "+this.font,this.selectionState===t.SelectionState.Caret)?this.caretX=Ct.measureText(this.text.slice(0,this.caretIndex).join("")).width:this.caretX=Ct.measureText(this.text.slice(0,this.caretIndex===this.selectionStart?this.selectionEnd:this.selectionStart).join("")).width;var e=this.textScroll+this.caretX,i=Ct.measureText(this.text.join("")).width,n=this.width-this.padding.left-this.padding.right,r=this.selectionState===t.SelectionState.Caret?this.caretIndex:this.selectionEnd===this.caretIndex?this.selectionStart:this.selectionEnd;if(i<n)this.textScroll=0;else if(e>n-5){var s=r>=this.text.length?0:Ct.measureText(this.text[r]).width;this.textScroll=n-this.caretX-s}else if(e<5){s=r<=0?0:Ct.measureText(this.text[r-1]).width;this.textScroll=-this.caretX+s}},i.prototype.render=function(e){var i=this.getStage(),n=this.focused?this.textures.Focused_Left:this.textures.Unfocused_Left,r=this.focused?this.textures.Focused_Right:this.textures.Unfocused_Right,s=this.focused?this.textures.Focused_Mid:this.textures.Unfocused_Mid;e.drawImage(n,0,0),e.drawImage(r,this.width-r.width,0),e.fillStyle=this.focused?this.focusedMidPattern:this.unfocusedMidPattern,e.fillRect(n.width,0,this.width-n.width-r.width,s.height),e.beginPath(),e.rect(this.padding.left,this.padding.top,this.width-this.padding.right-this.padding.left,this.height-this.padding.bottom-this.padding.top),e.clip(),this.selectionState===t.SelectionState.Selection?this.renderSelection(e):this.selectionState===t.SelectionState.Caret&&i.insertMode?this.renderCaretInsert(e):this.selectionState===t.SelectionState.Caret&&this.renderCaret(e)},i.prototype.setText=function(t){return this.text=t.split(""),this},i.prototype.keyDown=function(i){var n=this.getStage();return this.selectionState===t.SelectionState.Selection?this.keyDownSelection(i):n&&n.insertMode&&this.selectionState===t.SelectionState.Caret?this.keyDownCaretInsert(i):this.selectionState===t.SelectionState.Caret&&this.keyDownCaret(i),e.prototype.keyDown.call(this,i)},i.prototype.keyPress=function(i){var n=this.getStage();return this.selectionState===t.SelectionState.Selection?this.keyPressSelection(i):n&&n.insertMode&&this.selectionState===t.SelectionState.Caret?this.keyPressCaretInsert(i):this.selectionState===t.SelectionState.Caret&&this.keyPressCaret(i),e.prototype.keyPress.call(this,i)},i.prototype.select=function(e,i){if(!Number.isFinite(e))throw new Error("Cannot select text on sprite "+this.id+": begin is not finite");if(!Number.isFinite(i))throw new Error("Cannot select text on sprite "+this.id+": end is not finite");if(e=Math.floor(e),this.text.length<e||e<0)throw new Error("Cannot select text on sprite "+this.id+": begin is not in range");if(i=Math.floor(i),this.text.length<e||e<0)throw new Error("Cannot select text on sprite "+this.id+": end is not in range");if(e>i)throw new Error("Cannot select text on sprite "+this.id+": begin is greater than end");return this.selectionState=t.SelectionState.Selection,this.selectionStart=e,this.selectionEnd=i,this.caretIndex=Math.min(Math.max(e,this.caretIndex),i),this},i.prototype.pointCollision=function(i){if(i.firstDown)this.caretIndex=this.getCaretIndex(i.tx);else if(this.active){var n=this.getCaretIndex(i.tx);n!==this.caretIndex?this.select(Math.min(n,this.caretIndex),Math.max(n,this.caretIndex)):this.selectionState=t.SelectionState.Caret}return e.prototype.pointCollision.call(this,i)},i.prototype.keyPressCaret=function(t){if(St.test(t.key))return this.text.splice(this.caretIndex,0,t.key),void this.moveCaretRight()},i.prototype.keyDownCaret=function(t){switch(t.key){case"Backspace":this.text.splice(this.caretIndex-1,1),this.moveCaretLeft();break;case"Delete":this.text.splice(this.caretIndex,1);break;case"ArrowLeft":if(t.shift){if((e=this.caretIndex-1)<0)break;this.select(e,this.caretIndex);break}this.moveCaretLeft();break;case"ArrowRight":if(t.shift){if((e=this.caretIndex+1)>this.text.length)break;this.select(this.caretIndex,e);break}this.moveCaretRight();break;case"End":if(t.shift){var e;(e=this.text.length)!==this.caretIndex&&this.select(this.caretIndex,e);break}this.caretIndex=this.text.length;break;case"Home":if(t.shift){0!==this.caretIndex&&this.select(0,this.caretIndex);break}this.caretIndex=0}},i.prototype.keyPressCaretInsert=function(t){if(St.test(t.key))return this.text.splice(this.caretIndex,1,t.key),void this.moveCaretRight()},i.prototype.keyDownCaretInsert=function(t){switch(t.key){case"Backspace":this.text.splice(this.caretIndex-1,1),this.moveCaretLeft();break;case"Delete":this.text.splice(this.caretIndex,1);break;case"ArrowLeft":if(t.shift){if((e=this.caretIndex-1)<0)break;this.select(e,this.caretIndex);break}this.moveCaretLeft();break;case"ArrowRight":if(t.shift){if((e=this.caretIndex+1)>this.text.length)break;this.select(this.caretIndex,e);break}this.moveCaretRight();break;case"End":if(t.shift){var e;(e=this.text.length)!==this.caretIndex&&this.select(this.caretIndex,e);break}this.caretIndex=this.text.length;break;case"Home":if(t.shift){0!==this.caretIndex&&this.select(0,this.caretIndex);break}this.caretIndex=0}},i.prototype.keyPressSelection=function(e){if(St.test(e.key))return this.text.splice(this.selectionStart,this.selectionEnd-this.selectionStart,e.key),this.caretIndex=this.selectionStart+1,this.selectionState=t.SelectionState.Caret,this.selectionStart=-1,void(this.selectionEnd=-1)},i.prototype.keyDownSelection=function(e){switch(e.key){case"Delete":case"Backspace":this.text.splice(this.selectionStart,this.selectionEnd-this.selectionStart),this.caretIndex=this.selectionStart,this.selectionState=t.SelectionState.Caret;break;case"ArrowLeft":if(e.shift){var i=this.caretIndex;if((n=(this.selectionStart===this.caretIndex?this.selectionEnd:this.selectionStart)-1)<0)break;if(i===n){this.selectionState=t.SelectionState.Caret;break}this.select(Math.min(i,n),Math.max(i,n));break}this.caretIndex=this.selectionStart,this.selectionState=t.SelectionState.Caret;break;case"ArrowRight":if(e.shift){i=this.caretIndex;if((n=(this.selectionStart===this.caretIndex?this.selectionEnd:this.selectionStart)+1)>this.text.length)break;if(i===n){this.selectionState=t.SelectionState.Caret;break}this.select(Math.min(i,n),Math.max(i,n));break}this.caretIndex=this.selectionEnd,this.selectionState=t.SelectionState.Caret;break;case"End":if(e.shift){var n;(n=this.text.length)!==this.caretIndex&&this.select(this.caretIndex,n);break}this.caretIndex=this.text.length,this.selectionState=t.SelectionState.Caret;break;case"Home":if(e.shift){0!==this.caretIndex&&this.select(0,this.caretIndex);break}this.caretIndex=0,this.selectionState=t.SelectionState.Caret}},i.prototype.renderCaret=function(t){var e=this.text.join("");t.translate(this.padding.left+this.textScroll,this.padding.top),t.font=this.fontSize+"px "+this.font,t.fillStyle=this.fontColor,t.textBaseline=Q.middle,t.fillText(e,0,.5*(this.height-this.padding.top-this.padding.bottom)),this.showCaret&&this.focused&&(t.beginPath(),t.moveTo(this.caretX,0),t.lineTo(this.caretX,this.height-this.padding.top-this.padding.bottom),t.stroke())},i.prototype.renderSelection=function(t){t.font=this.fontSize+"px "+this.font;var e=this.text.slice(0,this.selectionStart).join(""),i=this.text.slice(this.selectionStart,this.selectionEnd).join(""),n=this.text.slice(this.selectionEnd).join(""),r=t.measureText(e).width,s=t.measureText(i).width;t.textBaseline=Q.middle;var o=.5*(this.height-this.padding.top-this.padding.bottom);t.translate(this.padding.left+this.textScroll,this.padding.top+o),t.fillStyle=this.fontColor,t.fillText(e,0,0),t.translate(r,0),t.fillStyle=this.selectedFontBackgroundColor,t.fillRect(0,-o,s,this.height-this.padding.top-this.padding.bottom),t.fillStyle=this.selectedFontColor,t.fillText(i,0,0),t.translate(s,0),t.fillStyle=this.fontColor,t.fillText(n,0,0)},i.prototype.renderCaretInsert=function(t){t.font=this.fontSize+"px "+this.font;var e=this.text.slice(0,this.caretIndex).join(""),i=this.text[this.caretIndex],n=this.text.slice(this.caretIndex+1).join(""),r=t.measureText(e).width,s=t.measureText(i).width;t.textBaseline=Q.middle;var o=.5*(this.height-this.padding.top-this.padding.bottom);t.translate(this.padding.left+this.textScroll,this.padding.top+o),t.fillStyle=this.fontColor,t.fillText(e,0,0),i?(t.translate(r,0),t.fillStyle=this.selectedFontBackgroundColor,t.fillRect(0,-o,s,this.height-this.padding.top-this.padding.bottom),t.fillStyle=this.selectedFontColor,t.fillText(i,0,0),n&&(t.translate(s,0),t.fillStyle=this.fontColor,t.fillText(n,0,0))):this.showCaret&&this.focused&&(t.beginPath(),t.moveTo(this.caretX,-o),t.lineTo(this.caretX,this.height-this.padding.top-this.padding.bottom-o),t.stroke())},i.prototype.moveCaretLeft=function(){this.caretIndex-=1,this.frameCount=0,this.showCaret=!0,this.caretIndex<0&&(this.caretIndex=0)},i.prototype.moveCaretRight=function(){this.caretIndex+=1,this.frameCount=0,this.showCaret=!0,this.caretIndex>this.text.length&&(this.caretIndex=this.text.length)},i.prototype.getCaretIndex=function(t){Ct.font=this.fontSize+"px "+this.font;for(var e=0,i="",n=0;n<this.text.length;n++){if(Ct.measureText(i+=this.text[n]).width+this.textScroll>t)return e;e+=1}return this.text.length},i}(nt);t.Matrix=A,t.Ease=P,t.Util=et,t.Spritesheet=$,t.loadSpriteSheet=X,t.createSpriteSheet=N,t.createTextureMap=Y,t.loadImage=j,t.Button=rt,t.Character=st,t.Checkbox=ot,t.Close=at,t.Container=ht,t.InteractionManager=lt,t.Label=ut,t.Panel=ft,t.SFXSprite=vt,t.Slider=yt,t.Sprite=nt,t.Stage=gt,t.Textbox=wt,t.TextInput=kt,t.EventEmitter=it});
//# sourceMappingURL=senpai-stage.umd.js.map
